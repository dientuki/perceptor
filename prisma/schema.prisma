generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
}

model TmdbResult {
  id             Int      @id @default(autoincrement())
  tmdbId         Int    @unique
  job        Job?

  media_type     String

  // Campos comunes
  adult             Boolean?
  backdrop_path     String?
  original_language String?
  language          Language? @relation("LanguageToTmdbResult", fields: [original_language], references: [iso2])
  overview          String?
  popularity        Float?
  poster_path       String?
  vote_average      Float?
  vote_count        Int?

  // Campos específicos de Movie
  original_title    String?
  release_date      String? // Fecha de estreno
  title             String?
  video             Boolean?

  // Campos específicos de TV
  original_name     String?
  first_air_date    String?
  name              String?

  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@unique([tmdbId, media_type])
  @@map("tmdb_results")
}

enum DownloadStatus {
  CREATED        // Job creado en el sistema
  SEARCHING      // Buscando torrent en tracker
  ADDED          // Torrent agregado al cliente
  DOWNLOADING    // Descargando activamente
  PAUSED         // Pausado en cliente
  COMPLETED      // Descarga finalizada
  ERROR          // Error en cualquier punto
}

enum EncodeStatus {
  WAITING
  QUEUED
  ENCODING
  COMPLETED
  ERROR
}

model Job {
  id        Int      @id @default(autoincrement())
  tmdbId    Int      @unique
  tmdb      TmdbResult @relation(fields: [tmdbId], references: [tmdbId])
  infoHash  String?
  
  downloadStatus  DownloadStatus @default(CREATED)
  encodeStatus    EncodeStatus   @default(WAITING)

  errorMessage    String?
  root_path   String? // Ruta al archivo descargado o al resultado del encode
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@map("jobs")
}

model Setting {
  id        Int      @id @default(autoincrement())
  key       String   @unique
  value     String
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@map("settings")
}

model Language {
  id   Int    @id @default(autoincrement())
  iso2 String @unique
  tmdbResults TmdbResult[] @relation("LanguageToTmdbResult")

  iso3 String

  @@map("languages")
}